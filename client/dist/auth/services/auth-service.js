"use strict";var __decorate=this&&this.__decorate||function(t,e,r,n){var o,a=arguments.length,c=3>a?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(c=(3>a?o(c):a>3?o(e,r,c):o(e,r))||c);return a>3&&c&&Object.defineProperty(e,r,c),c},__metadata=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__param=this&&this.__param||function(t,e){return function(r,n){e(r,n,t)}},core_1=require("@angular/core"),Observable_1=require("rxjs/Observable"),BehaviorSubject_1=require("rxjs/BehaviorSubject"),http_1=require("@angular/http"),angular2_jwt_1=require("angular2-jwt");require("rxjs/add/operator/map"),require("rxjs/add/operator/do");var AuthService=function(){function t(t){this._http=t,this._jwtHelper=new angular2_jwt_1.JwtHelper;var e,r=this.getJwt();if(r)try{e=this._jwtHelper.decodeToken(r)}catch(n){}this.currentUserSource=new BehaviorSubject_1.BehaviorSubject(e),this.currentUser=this.currentUserSource.asObservable(),this.checkCurrentUser()}return t.prototype.saveJwt=function(t){localStorage.setItem("calcium_jwt",t)},t.prototype.clearJwt=function(){localStorage.removeItem("calcium_jwt")},t.prototype.getJwt=function(){return localStorage.getItem("calcium_jwt")},t.prototype.login=function(e,r){var n=this,o=JSON.stringify({email:e,password:r}),a=new http_1.Headers({"Content-Type":"application/json"});new angular2_jwt_1.JwtHelper;return this._http.post(t.LOGIN_ENDPOINT,o,{headers:a}).map(function(t){return t.json()})["do"](function(t){return n.saveJwt(t)}).map(function(t){return n._jwtHelper.decodeToken(t)})["do"](function(t){return n.currentUserSource.next(t)})},t.prototype.logout=function(){var e=this,r=new http_1.Headers({"Content-Type":"application/json"});return this._http.get(t.LOGOUT_ENDPOINT,{headers:r}).map(function(t){return t.json()})["do"](function(t){return e.clearJwt()})["do"](function(t){return e.currentUserSource.next(null)})},t.prototype.checkCurrentUser=function(){var e=this,r=new http_1.Headers({"Content-Type":"application/json"});this._http.get(t.USER_ENDPOINT,{headers:r}).map(function(t){return t.json()})["catch"](function(t,e){return Observable_1.Observable.empty()}).subscribe(function(t){return e.currentUserSource.next(t)})},t.LOGIN_ENDPOINT="/auth/login",t.LOGOUT_ENDPOINT="/auth/logout",t.USER_ENDPOINT="/api/users/me",t=__decorate([core_1.Injectable(),__param(0,core_1.Inject(angular2_jwt_1.AuthHttp)),__metadata("design:paramtypes",[angular2_jwt_1.AuthHttp])],t)}();exports.AuthService=AuthService;